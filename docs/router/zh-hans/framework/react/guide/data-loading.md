---
source-updated-at: 2025-02-22T09:47:51.000Z
translation-updated-at: 2025-04-05T03:27:12.000Z
title: æ•°æ®åŠ è½½
id: data-loading
---

# æ•°æ®åŠ è½½

æ•°æ®åŠ è½½æ˜¯Webåº”ç”¨ç¨‹åºçš„å¸¸è§å…³æ³¨ç‚¹ï¼Œä¸è·¯ç”±å¯†åˆ‡ç›¸å…³ã€‚åœ¨åŠ è½½åº”ç”¨ç¨‹åºé¡µé¢æ—¶ï¼Œç†æƒ³æƒ…å†µæ˜¯å°½æ—©å¹¶è¡Œè·å–å¹¶æ»¡è¶³é¡µé¢çš„æ‰€æœ‰å¼‚æ­¥éœ€æ±‚ã€‚è·¯ç”±æ˜¯åè°ƒè¿™äº›å¼‚æ­¥ä¾èµ–é¡¹çš„æœ€ä½³ä½ç½®ï¼Œå› ä¸ºå®ƒé€šå¸¸æ˜¯åº”ç”¨ç¨‹åºä¸­å”¯ä¸€åœ¨å†…å®¹æ¸²æŸ“å‰å°±çŸ¥é“ç”¨æˆ·å»å‘çš„åœ°æ–¹ã€‚

æ‚¨å¯èƒ½ç†Ÿæ‚‰Next.jsçš„`getServerSideProps`æˆ–Remix/React-Routerçš„`loader`ã€‚TanStack Routerå…·æœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå¯ä»¥å¹¶è¡Œé¢„åŠ è½½/æŒ‰è·¯ç”±åŠ è½½èµ„æºï¼Œé€šè¿‡Suspenseè·å–æ•°æ®å®ç°å°½å¯èƒ½å¿«çš„æ¸²æŸ“ã€‚

é™¤äº†è·¯ç”±å™¨çš„è¿™äº›å¸¸è§„åŠŸèƒ½å¤–ï¼ŒTanStack Routeræ›´è¿›ä¸€æ­¥ï¼Œæä¾›äº†**å†…ç½®çš„SWRç¼“å­˜**ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºè·¯ç”±åŠ è½½å™¨çš„é•¿æœŸå†…å­˜ç¼“å­˜å±‚ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨TanStack Routeré¢„åŠ è½½è·¯ç”±æ•°æ®ä»¥å®ç°å³æ—¶åŠ è½½ï¼Œæˆ–ä¸´æ—¶ç¼“å­˜å…ˆå‰è®¿é—®è¿‡çš„è·¯ç”±æ•°æ®ä»¥ä¾›åç»­ä½¿ç”¨ã€‚

## è·¯ç”±åŠ è½½ç”Ÿå‘½å‘¨æœŸ

æ¯æ¬¡æ£€æµ‹åˆ°URL/å†å²è®°å½•æ›´æ–°æ—¶ï¼Œè·¯ç”±å™¨ä¼šæ‰§è¡Œä»¥ä¸‹åºåˆ—ï¼š

- è·¯ç”±åŒ¹é…ï¼ˆè‡ªä¸Šè€Œä¸‹ï¼‰
  - `route.params.parse`
  - `route.validateSearch`
- è·¯ç”±é¢„åŠ è½½ï¼ˆä¸²è¡Œï¼‰
  - `route.beforeLoad`
  - `route.onError`
    - `route.errorComponent` / `parentRoute.errorComponent` / `router.defaultErrorComponent`
- è·¯ç”±åŠ è½½ï¼ˆå¹¶è¡Œï¼‰
  - `route.component.preload?`
  - `route.loader`
    - `route.pendingComponent`ï¼ˆå¯é€‰ï¼‰
    - `route.component`
  - `route.onError`
    - `route.errorComponent` / `parentRoute.errorComponent` / `router.defaultErrorComponent`

## ä½¿ç”¨è·¯ç”±ç¼“å­˜è¿˜æ˜¯ä¸ä½¿ç”¨ï¼Ÿ

TanStackçš„è·¯ç”±ç¼“å­˜å¾ˆå¯èƒ½éå¸¸é€‚åˆå¤§å¤šæ•°ä¸­å°å‹åº”ç”¨ç¨‹åºï¼Œä½†é‡è¦çš„æ˜¯è¦ç†è§£ä½¿ç”¨å®ƒä¸æ›´å¥å£®çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼ˆå¦‚TanStack Queryï¼‰ä¹‹é—´çš„æƒè¡¡ï¼š

TanStackè·¯ç”±ç¼“å­˜çš„ä¼˜ç‚¹ï¼š

- å†…ç½®ã€æ˜“äºä½¿ç”¨ï¼Œæ— éœ€é¢å¤–ä¾èµ–
- å¤„ç†å»é‡ã€é¢„åŠ è½½ã€åŠ è½½ã€è¿‡æ—¶é‡éªŒè¯ï¼ˆstale-while-revalidateï¼‰ã€æŒ‰è·¯ç”±åå°é‡æ–°è·å–
- ç²—ç²’åº¦å¤±æ•ˆï¼ˆä¸€æ¬¡æ€§å¤±æ•ˆæ‰€æœ‰è·¯ç”±å’Œç¼“å­˜ï¼‰
- è‡ªåŠ¨åƒåœ¾å›æ”¶
- éå¸¸é€‚åˆè·¯ç”±é—´å…±äº«æ•°æ®è¾ƒå°‘çš„åº”ç”¨ç¨‹åº
- å¯¹SSRâ€œå¼€ç®±å³ç”¨â€

TanStackè·¯ç”±ç¼“å­˜çš„ç¼ºç‚¹ï¼š

- æ²¡æœ‰æŒä¹…åŒ–é€‚é…å™¨/æ¨¡å‹
- è·¯ç”±é—´æ²¡æœ‰å…±äº«ç¼“å­˜/å»é‡
- æ²¡æœ‰å†…ç½®çš„å˜æ›´APIï¼ˆè®¸å¤šç¤ºä¾‹ä¸­æä¾›äº†åŸºæœ¬çš„`useMutation`é’©å­ï¼Œå¯èƒ½è¶³ä»¥æ»¡è¶³è®¸å¤šç”¨ä¾‹ï¼‰
- æ²¡æœ‰å†…ç½®çš„ç¼“å­˜çº§ä¹è§‚æ›´æ–°APIï¼ˆæ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨ç±»ä¼¼`useMutation`é’©å­çš„ä¸´æ—¶çŠ¶æ€åœ¨ç»„ä»¶çº§åˆ«å®ç°è¿™ä¸€ç‚¹ï¼‰

> [!TIP]
> å¦‚æœæ‚¨ç«‹å³çŸ¥é“æƒ³è¦æˆ–éœ€è¦ä½¿ç”¨æ›´å¥å£®çš„è§£å†³æ–¹æ¡ˆï¼ˆå¦‚TanStack Queryï¼‰ï¼Œè¯·è·³è½¬åˆ°[å¤–éƒ¨æ•°æ®åŠ è½½](./external-data-loading.md)æŒ‡å—ã€‚

## ä½¿ç”¨è·¯ç”±ç¼“å­˜

è·¯ç”±ç¼“å­˜æ˜¯å†…ç½®çš„ï¼Œåªéœ€ä»ä»»ä½•è·¯ç”±çš„`loader`å‡½æ•°è¿”å›æ•°æ®å³å¯ã€‚è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ä½¿ç”¨ï¼

## è·¯ç”±`loader`

è·¯ç”±`loader`å‡½æ•°åœ¨åŠ è½½è·¯ç”±åŒ¹é…æ—¶è°ƒç”¨ã€‚å®ƒä»¬æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«è®¸å¤šæœ‰ç”¨å±æ€§çš„å¯¹è±¡ã€‚æˆ‘ä»¬ç¨åä¼šè¯¦ç»†ä»‹ç»è¿™äº›å±æ€§ï¼Œä½†é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªè·¯ç”±`loader`å‡½æ•°çš„ç¤ºä¾‹ï¼š

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
})
```

## `loader`å‚æ•°

`loader`å‡½æ•°æ¥æ”¶ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å±æ€§çš„å¯¹è±¡ï¼š

- `abortController` - è·¯ç”±çš„abortControllerã€‚å½“è·¯ç”±å¸è½½æˆ–Routeä¸å†ç›¸å…³ä¸”å½“å‰`loader`å‡½æ•°è°ƒç”¨è¿‡æ—¶æ—¶ï¼Œå…¶ä¿¡å·ä¼šè¢«å–æ¶ˆã€‚
- `cause` - å½“å‰è·¯ç”±åŒ¹é…çš„åŸå› ï¼Œ`enter`æˆ–`stay`ã€‚
- `context` - è·¯ç”±çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ˜¯ä»¥ä¸‹å†…å®¹çš„åˆå¹¶ï¼š
  - çˆ¶è·¯ç”±ä¸Šä¸‹æ–‡
  - ç”±`beforeLoad`é€‰é¡¹æä¾›çš„æ­¤è·¯ç”±ä¸Šä¸‹æ–‡
- `deps` - ä»`Route.loaderDeps`å‡½æ•°è¿”å›çš„å¯¹è±¡å€¼ã€‚å¦‚æœæœªå®šä¹‰`Route.loaderDeps`ï¼Œåˆ™æä¾›ç©ºå¯¹è±¡ã€‚
- `location` - å½“å‰ä½ç½®
- `params` - è·¯ç”±çš„è·¯å¾„å‚æ•°
- `parentMatchPromise` - `Promise<RouteMatch>`ï¼ˆæ ¹è·¯ç”±ä¸º`undefined`ï¼‰
- `preload` - å¸ƒå°”å€¼ï¼Œå½“è·¯ç”±è¢«é¢„åŠ è½½è€ŒéåŠ è½½æ—¶ä¸º`true`
- `route` - è·¯ç”±æœ¬èº«

ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šå¾ˆé…·çš„äº‹æƒ…ï¼Œä½†é¦–å…ˆè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ§åˆ¶å®ƒä»¥åŠä½•æ—¶è°ƒç”¨`loader`å‡½æ•°ã€‚

## ä»`loader`æ¶ˆè´¹æ•°æ®

è¦ä»`loader`æ¶ˆè´¹æ•°æ®ï¼Œè¯·ä½¿ç”¨Routeå¯¹è±¡ä¸Šå®šä¹‰çš„`useLoaderData`é’©å­ã€‚

```tsx
const posts = Route.useLoaderData()
```

å¦‚æœæ‚¨æ— æ³•ç›´æ¥è®¿é—®è·¯ç”±å¯¹è±¡ï¼ˆå³æ‚¨ä½äºå½“å‰è·¯ç”±çš„ç»„ä»¶æ ‘æ·±å¤„ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨`getRouteApi`è®¿é—®ç›¸åŒçš„é’©å­ï¼ˆä»¥åŠRouteå¯¹è±¡ä¸Šçš„å…¶ä»–é’©å­ï¼‰ã€‚è¿™åº”ä¼˜å…ˆäºå¯¼å…¥Routeå¯¹è±¡ï¼Œåè€…å¯èƒ½ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–ã€‚

```tsx
import { getRouteApi } from '@tanstack/react-router'

// åœ¨æ‚¨çš„ç»„ä»¶ä¸­

const routeApi = getRouteApi('/posts')
const data = routeApi.useLoaderData()
```

## åŸºäºä¾èµ–é¡¹çš„è¿‡æ—¶é‡éªŒè¯ç¼“å­˜

TanStack Routerä¸ºè·¯ç”±åŠ è½½å™¨æä¾›äº†ä¸€ä¸ªå†…ç½®çš„è¿‡æ—¶é‡éªŒè¯ï¼ˆStale-While-Revalidateï¼‰ç¼“å­˜å±‚ï¼Œå…¶é”®åŸºäºè·¯ç”±çš„ä¾èµ–é¡¹ï¼š

- è·¯ç”±çš„å®Œå…¨è§£æè·¯å¾„å
  - ä¾‹å¦‚`/posts/1`ä¸`/posts/2`
- ç”±`loaderDeps`é€‰é¡¹æä¾›çš„ä»»ä½•å…¶ä»–ä¾èµ–é¡¹
  - ä¾‹å¦‚`loaderDeps: ({ search: { pageIndex, pageSize } }) => ({ pageIndex, pageSize })`

ä½¿ç”¨è¿™äº›ä¾èµ–é¡¹ä½œä¸ºé”®ï¼ŒTanStack Routerå°†ç¼“å­˜ä»è·¯ç”±`loader`å‡½æ•°è¿”å›çš„æ•°æ®ï¼Œå¹¶ç”¨å®ƒæ¥æ»¡è¶³å¯¹ç›¸åŒè·¯ç”±åŒ¹é…çš„åç»­è¯·æ±‚ã€‚è¿™æ„å‘³ç€å¦‚æœè·¯ç”±æ•°æ®å·²åœ¨ç¼“å­˜ä¸­ï¼Œå®ƒå°†ç«‹å³è¿”å›ï¼Œç„¶å**å¯èƒ½**åœ¨åå°é‡æ–°è·å–ï¼Œå…·ä½“å–å†³äºæ•°æ®çš„â€œæ–°é²œåº¦â€ã€‚

### å…³é”®é€‰é¡¹

ä¸ºäº†æ§åˆ¶è·¯ç”±ä¾èµ–é¡¹å’Œâ€œæ–°é²œåº¦â€ï¼ŒTanStack Routeræä¾›äº†å¤§é‡é€‰é¡¹æ¥æ§åˆ¶è·¯ç”±åŠ è½½å™¨çš„é”®å’Œç¼“å­˜è¡Œä¸ºã€‚è®©æˆ‘ä»¬æŒ‰æ‚¨æœ€å¯èƒ½ä½¿ç”¨çš„é¡ºåºæ¥çœ‹ä¸€ä¸‹ï¼š

- `routeOptions.loaderDeps`
  - ä¸€ä¸ªå‡½æ•°ï¼Œæä¾›è·¯ç”±å™¨çš„æœç´¢å‚æ•°å¹¶è¿”å›ä¸€ä¸ªä¾èµ–é¡¹å¯¹è±¡ä¾›`loader`å‡½æ•°ä½¿ç”¨ã€‚å½“è¿™äº›ä¾èµ–é¡¹åœ¨å¯¼èˆªé—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ— è®º`staleTime`å¦‚ä½•ï¼Œéƒ½ä¼šå¯¼è‡´è·¯ç”±é‡æ–°åŠ è½½ã€‚ä¾èµ–é¡¹ä½¿ç”¨æ·±åº¦ç›¸ç­‰æ£€æŸ¥è¿›è¡Œæ¯”è¾ƒã€‚
- `routeOptions.staleTime`
- `routerOptions.defaultStaleTime`
  - å°è¯•åŠ è½½æ—¶è·¯ç”±æ•°æ®åº”è¢«è§†ä¸ºæ–°é²œçš„æ¯«ç§’æ•°ã€‚
- `routeOptions.preloadStaleTime`
- `routerOptions.defaultPreloadStaleTime`
  - å°è¯•é¢„åŠ è½½æ—¶è·¯ç”±æ•°æ®åº”è¢«è§†ä¸ºæ–°é²œçš„æ¯«ç§’æ•°ã€‚
- `routeOptions.gcTime`
- `routerOptions.defaultGcTime`
  - è·¯ç”±æ•°æ®åœ¨è¢«åƒåœ¾å›æ”¶å‰åº”ä¿ç•™åœ¨ç¼“å­˜ä¸­çš„æ¯«ç§’æ•°ã€‚
- `routeOptions.shouldReload`
  - ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸`beforeLoad`å’Œ`loaderContext`ç›¸åŒçš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè·¯ç”±æ˜¯å¦åº”é‡æ–°åŠ è½½ã€‚è¿™æä¾›äº†åœ¨`staleTime`å’Œ`loaderDeps`ä¹‹å¤–æ§åˆ¶è·¯ç”±ä½•æ—¶é‡æ–°åŠ è½½çš„é¢å¤–çº§åˆ«ï¼Œå¯ç”¨äºå®ç°ç±»ä¼¼äºRemixçš„`shouldLoad`é€‰é¡¹çš„æ¨¡å¼ã€‚

### âš ï¸ ä¸€äº›é‡è¦é»˜è®¤å€¼

- é»˜è®¤æƒ…å†µä¸‹ï¼Œ`staleTime`è®¾ç½®ä¸º`0`ï¼Œæ„å‘³ç€è·¯ç”±æ•°æ®å°†å§‹ç»ˆè¢«è§†ä¸ºè¿‡æ—¶ï¼Œå¹¶åœ¨è·¯ç”±é‡æ–°åŒ¹é…æ—¶å§‹ç»ˆåœ¨åå°é‡æ–°åŠ è½½ã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼Œå…ˆå‰é¢„åŠ è½½çš„è·¯ç”±è¢«è§†ä¸ºæ–°é²œ**30ç§’**ã€‚è¿™æ„å‘³ç€å¦‚æœè·¯ç”±è¢«é¢„åŠ è½½ï¼Œç„¶ååœ¨30ç§’å†…å†æ¬¡é¢„åŠ è½½ï¼Œç¬¬äºŒæ¬¡é¢„åŠ è½½å°†è¢«å¿½ç•¥ã€‚è¿™é˜²æ­¢ä¸å¿…è¦çš„é¢„åŠ è½½è¿‡äºé¢‘ç¹å‘ç”Ÿã€‚**å½“è·¯ç”±æ­£å¸¸åŠ è½½æ—¶ï¼Œä½¿ç”¨æ ‡å‡†çš„`staleTime`ã€‚**
- é»˜è®¤æƒ…å†µä¸‹ï¼Œ`gcTime`è®¾ç½®ä¸º**30åˆ†é’Ÿ**ï¼Œæ„å‘³ç€ä»»ä½•30åˆ†é’Ÿå†…æœªè¢«è®¿é—®çš„è·¯ç”±æ•°æ®å°†è¢«åƒåœ¾å›æ”¶å¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ã€‚
- `router.invalidate()`å°†å¼ºåˆ¶æ‰€æœ‰æ´»åŠ¨è·¯ç”±ç«‹å³é‡æ–°åŠ è½½å…¶åŠ è½½å™¨ï¼Œå¹¶å°†æ¯ä¸ªç¼“å­˜çš„è·¯ç”±æ•°æ®æ ‡è®°ä¸ºè¿‡æ—¶ã€‚

### ä½¿ç”¨`loaderDeps`è®¿é—®æœç´¢å‚æ•°

å‡è®¾`/posts`è·¯ç”±é€šè¿‡æœç´¢å‚æ•°`offset`å’Œ`limit`æ”¯æŒåˆ†é¡µã€‚ä¸ºäº†ä½¿ç¼“å­˜èƒ½å”¯ä¸€å­˜å‚¨è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡`loaderDeps`å‡½æ•°è®¿é—®è¿™äº›æœç´¢å‚æ•°ã€‚é€šè¿‡æ˜ç¡®æ ‡è¯†å®ƒä»¬ï¼Œ`/posts`çš„ä¸åŒ`offset`å’Œ`limit`çš„è·¯ç”±åŒ¹é…ä¸ä¼šæ··æ·†ï¼

ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™äº›ä¾èµ–é¡¹ï¼Œå½“ä¾èµ–é¡¹æ›´æ”¹æ—¶ï¼Œè·¯ç”±å°†å§‹ç»ˆé‡æ–°åŠ è½½ã€‚

```tsx
// /routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loaderDeps: ({ search: { offset, limit } }) => ({ offset, limit }),
  loader: ({ deps: { offset, limit } }) =>
    fetchPosts({
      offset,
      limit,
    }),
})
```

### ä½¿ç”¨`staleTime`æ§åˆ¶æ•°æ®è¢«è§†ä¸ºæ–°é²œçš„æ—¶é—´

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¼èˆªçš„`staleTime`è®¾ç½®ä¸º`0`æ¯«ç§’ï¼ˆé¢„åŠ è½½ä¸º30ç§’ï¼‰ï¼Œè¿™æ„å‘³ç€è·¯ç”±æ•°æ®å°†å§‹ç»ˆè¢«è§†ä¸ºè¿‡æ—¶ï¼Œå¹¶åœ¨è·¯ç”±åŒ¹é…å’Œå¯¼èˆªåˆ°æ—¶å§‹ç»ˆåœ¨åå°é‡æ–°åŠ è½½ã€‚

**è¿™å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤å€¼ï¼Œä½†æ‚¨å¯èƒ½ä¼šå‘ç°æŸäº›è·¯ç”±æ•°æ®æ›´é™æ€æˆ–åŠ è½½æˆæœ¬æ›´é«˜ã€‚**åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`staleTime`é€‰é¡¹æ¥æ§åˆ¶è·¯ç”±æ•°æ®åœ¨å¯¼èˆªä¸­è¢«è§†ä¸ºæ–°é²œçš„æ—¶é—´ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š

```tsx
// /routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  // è·¯ç”±æ•°æ®è¢«è§†ä¸ºæ–°é²œ10ç§’
  staleTime: 10_000,
})
```

é€šè¿‡å°†`10_000`ä¼ é€’ç»™`staleTime`é€‰é¡¹ï¼Œæˆ‘ä»¬å‘Šè¯‰è·¯ç”±å™¨å°†è·¯ç”±æ•°æ®è§†ä¸ºæ–°é²œ10ç§’ã€‚è¿™æ„å‘³ç€å¦‚æœç”¨æˆ·åœ¨æœ€åä¸€æ¬¡åŠ è½½å™¨ç»“æœçš„10ç§’å†…ä»`/about`å¯¼èˆªåˆ°`/posts`ï¼Œè·¯ç”±æ•°æ®å°†ä¸ä¼šé‡æ–°åŠ è½½ã€‚å¦‚æœç”¨æˆ·åœ¨10ç§’åä»`/about`å¯¼èˆªåˆ°`/posts`ï¼Œè·¯ç”±æ•°æ®å°†åœ¨**åå°**é‡æ–°åŠ è½½ã€‚

## å…³é—­è¿‡æ—¶é‡éªŒè¯ç¼“å­˜

è¦ç¦ç”¨è·¯ç”±çš„è¿‡æ—¶é‡éªŒè¯ç¼“å­˜ï¼Œå°†`staleTime`é€‰é¡¹è®¾ç½®ä¸º`Infinity`ï¼š

```tsx
// /routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  staleTime: Infinity,
})
```

æ‚¨ç”šè‡³å¯ä»¥é€šè¿‡åœ¨è·¯ç”±å™¨ä¸Šè®¾ç½®`defaultStaleTime`é€‰é¡¹ä¸ºæ‰€æœ‰è·¯ç”±å…³é—­æ­¤åŠŸèƒ½ï¼š

```tsx
const router = createRouter({
  routeTree,
  defaultStaleTime: Infinity,
})
```

## ä½¿ç”¨`shouldReload`å’Œ`gcTime`é€‰æ‹©é€€å‡ºç¼“å­˜

ç±»ä¼¼äºRemixçš„é»˜è®¤åŠŸèƒ½ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é…ç½®è·¯ç”±ä»…åœ¨è¿›å…¥æˆ–å…³é”®åŠ è½½å™¨ä¾èµ–é¡¹æ›´æ”¹æ—¶åŠ è½½ã€‚æ‚¨å¯ä»¥é€šè¿‡ç»“åˆä½¿ç”¨`gcTime`é€‰é¡¹å’Œ`shouldReload`é€‰é¡¹æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œ`shouldReload`æ¥å—ä¸€ä¸ª`boolean`æˆ–ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸`beforeLoad`å’Œ`loaderContext`ç›¸åŒçš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè·¯ç”±æ˜¯å¦åº”é‡æ–°åŠ è½½ã€‚

```tsx
// /routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loaderDeps: ({ search: { offset, limit } }) => ({ offset, limit }),
  loader: ({ deps }) => fetchPosts(deps),
  // è·¯ç”±å¸è½½åä¸ç¼“å­˜æ­¤è·¯ç”±æ•°æ®
  gcTime: 0,
  // ä»…åœ¨ç”¨æˆ·å¯¼èˆªåˆ°è·¯ç”±æˆ–ä¾èµ–é¡¹æ›´æ”¹æ—¶é‡æ–°åŠ è½½è·¯ç”±
  shouldReload: false,
})
```

### é€‰æ‹©é€€å‡ºç¼“å­˜åŒæ—¶ä»é¢„åŠ è½½

å³ä½¿æ‚¨é€‰æ‹©é€€å‡ºè·¯ç”±æ•°æ®çš„çŸ­æœŸç¼“å­˜ï¼Œæ‚¨ä»ç„¶å¯ä»¥è·å¾—é¢„åŠ è½½çš„å¥½å¤„ï¼ä½¿ç”¨ä¸Šè¿°é…ç½®ï¼Œé¢„åŠ è½½ä»å°†â€œæ­£å¸¸å·¥ä½œâ€ï¼Œä½¿ç”¨é»˜è®¤çš„`preloadGcTime`ã€‚è¿™æ„å‘³ç€å¦‚æœè·¯ç”±è¢«é¢„åŠ è½½ï¼Œç„¶åå¯¼èˆªåˆ°ï¼Œè·¯ç”±æ•°æ®å°†è¢«è§†ä¸ºæ–°é²œä¸”ä¸ä¼šé‡æ–°åŠ è½½ã€‚

è¦é€‰æ‹©é€€å‡ºé¢„åŠ è½½ï¼Œä¸è¦é€šè¿‡`routerOptions.defaultPreload`æˆ–`routeOptions.preload`é€‰é¡¹å¯ç”¨å®ƒã€‚

## å°†æ‰€æœ‰åŠ è½½å™¨äº‹ä»¶ä¼ é€’ç»™å¤–éƒ¨ç¼“å­˜

æˆ‘ä»¬åœ¨[å¤–éƒ¨æ•°æ®åŠ è½½](./external-data-loading.md)é¡µé¢ä¸­åˆ†è§£äº†è¿™ä¸ªç”¨ä¾‹ï¼Œä½†å¦‚æœæ‚¨æƒ³ä½¿ç”¨åƒTanStack Queryè¿™æ ·çš„å¤–éƒ¨ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡å°†æ‰€æœ‰åŠ è½½å™¨äº‹ä»¶ä¼ é€’ç»™å¤–éƒ¨ç¼“å­˜æ¥å®ç°ã€‚åªè¦æ‚¨ä½¿ç”¨é»˜è®¤å€¼ï¼Œå”¯ä¸€éœ€è¦åšçš„æ›´æ”¹æ˜¯å°†è·¯ç”±å™¨ä¸Šçš„`defaultPreloadStaleTime`é€‰é¡¹è®¾ç½®ä¸º`0`ï¼š

```tsx
const router = createRouter({
  routeTree,
  defaultPreloadStaleTime: 0,
})
```

è¿™å°†ç¡®ä¿æ¯æ¬¡é¢„åŠ è½½ã€åŠ è½½å’Œé‡æ–°åŠ è½½äº‹ä»¶éƒ½ä¼šè§¦å‘æ‚¨çš„`loader`å‡½æ•°ï¼Œç„¶åå¯ä»¥ç”±æ‚¨çš„å¤–éƒ¨ç¼“å­˜å¤„ç†å’Œå»é‡ã€‚

## ä½¿ç”¨è·¯ç”±å™¨ä¸Šä¸‹æ–‡

ä¼ é€’ç»™`loader`å‡½æ•°çš„`context`å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹åˆå¹¶çš„å¯¹è±¡ï¼š

- çˆ¶è·¯ç”±ä¸Šä¸‹æ–‡
- ç”±`beforeLoad`é€‰é¡¹æä¾›çš„æ­¤è·¯ç”±ä¸Šä¸‹æ–‡

ä»è·¯ç”±å™¨çš„é¡¶éƒ¨å¼€å§‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡`context`é€‰é¡¹å‘è·¯ç”±å™¨ä¼ é€’åˆå§‹ä¸Šä¸‹æ–‡ã€‚æ­¤ä¸Šä¸‹æ–‡å°†å¯¹è·¯ç”±å™¨ä¸­çš„æ‰€æœ‰è·¯ç”±å¯ç”¨ï¼Œå¹¶åœ¨åŒ¹é…æ—¶è¢«æ¯ä¸ªè·¯ç”±å¤åˆ¶å’Œæ‰©å±•ã€‚è¿™æ˜¯é€šè¿‡`beforeLoad`é€‰é¡¹å‘è·¯ç”±ä¼ é€’ä¸Šä¸‹æ–‡å®ç°çš„ã€‚æ­¤ä¸Šä¸‹æ–‡å°†å¯¹è·¯ç”±çš„æ‰€æœ‰å­è·¯ç”±å¯ç”¨ã€‚ç”Ÿæˆçš„ä¸Šä¸‹æ–‡å°†å¯¹è·¯ç”±çš„`loader`å‡½æ•°å¯ç”¨ã€‚

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨è·¯ç”±ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥è·å–å¸–å­ï¼Œç„¶ååœ¨`loader`å‡½æ•°ä¸­ä½¿ç”¨å®ƒã€‚

> ğŸ§  ä¸Šä¸‹æ–‡æ˜¯ä¾èµ–æ³¨å…¥çš„å¼ºå¤§å·¥å…·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒå‘è·¯ç”±å™¨å’Œè·¯ç”±æ³¨å…¥æœåŠ¡ã€é’©å­å’Œå…¶ä»–å¯¹è±¡ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è·¯ç”±çš„`beforeLoad`é€‰é¡¹åœ¨è·¯ç”±æ ‘ä¸­é€å±‚ä¼ é€’æ•°æ®ã€‚

- `/utils/fetchPosts.tsx`

```tsx
export const fetchPosts = async () => {
  const res = await fetch(`/api/posts?page=${pageIndex}`)
  if (!res.ok) throw new Error('Failed to fetch posts')
  return res.json()
}
```

- `/routes/__root.tsx`

```tsx
import { createRootRouteWithContext } from '@tanstack/react-router'

// ä½¿ç”¨createRootRouteWithContext<{...}>()å‡½æ•°åˆ›å»ºæ ¹è·¯ç”±ï¼Œå¹¶ä¼ é€’æ‚¨å¸Œæœ›åœ¨è·¯ç”±å™¨ä¸Šä¸‹æ–‡ä¸­å¯ç”¨çš„ä»»ä½•ç±»å‹ã€‚
export const Route = createRootRouteWithContext<{
  fetchPosts: typeof fetchPosts
}>()() // æ³¨æ„ï¼šåŒè°ƒç”¨æ˜¯æœ‰æ„çš„ï¼Œå› ä¸ºcreateRootRouteWithContextæ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°;)
```

- `/routes/posts.tsx`

```tsx
import { createFileRoute } from '@tanstack/react-router'

// æ³¨æ„æˆ‘ä»¬çš„postsRouteå¦‚ä½•å¼•ç”¨ä¸Šä¸‹æ–‡ä»¥è·å–fetchPostså‡½æ•°
// è¿™å¯ä»¥æˆä¸ºåœ¨è·¯ç”±å™¨å’Œè·¯ç”±ä¹‹é—´è¿›è¡Œä¾èµ–æ³¨å…¥çš„å¼ºå¤§å·¥å…·ã€‚
export const Route = createFileRoute('/posts')({
  loader: ({ context: { fetchPosts } }) => fetchPosts(),
})
```

- `/router.tsx`

````tsx
import { routeTree } from './routeTree.gen'
```ä»¥ä¸‹æ˜¯ç¿»è¯‘åçš„ä¸­æ–‡æ–‡æ¡£ï¼Œä¿æŒæ‰€æœ‰ä»£ç å—ã€Markdownæ ¼å¼ã€HTMLæ ‡ç­¾å’Œå˜é‡ä¸å˜ï¼š

// ä½¿ç”¨ä½ çš„routerContextåˆ›å»ºä¸€ä¸ªæ–°è·¯ç”±
// è¿™å°†è¦æ±‚ä½ æ»¡è¶³routerContextçš„ç±»å‹è¦æ±‚
const router = createRouter({
  routeTree,
  context: {
    // å°†fetchPostså‡½æ•°æä¾›ç»™è·¯ç”±ä¸Šä¸‹æ–‡
    fetchPosts,
  },
})
````

## ä½¿ç”¨è·¯å¾„å‚æ•°

è¦åœ¨`loader`å‡½æ•°ä¸­ä½¿ç”¨è·¯å¾„å‚æ•°ï¼Œå¯é€šè¿‡å‡½æ•°å‚æ•°çš„`params`å±æ€§è®¿é—®å®ƒä»¬ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```tsx
// routes/posts.$postId.tsx
export const Route = createFileRoute('/posts/$postId')({
  loader: ({ params: { postId } }) => fetchPostById(postId),
})
```

## ä½¿ç”¨è·¯ç”±ä¸Šä¸‹æ–‡

å‘è·¯ç”±ä¼ é€’å…¨å±€ä¸Šä¸‹æ–‡å›ºç„¶å¾ˆå¥½ï¼Œä½†å¦‚æœæƒ³æä¾›ç‰¹å®šäºè·¯ç”±çš„ä¸Šä¸‹æ–‡å‘¢ï¼Ÿè¿™æ—¶`beforeLoad`é€‰é¡¹å°±æ´¾ä¸Šç”¨åœºäº†ã€‚`beforeLoad`æ˜¯ä¸€ä¸ªåœ¨å°è¯•åŠ è½½è·¯ç”±å‰è¿è¡Œçš„å‡½æ•°ï¼Œæ¥æ”¶ä¸`loader`ç›¸åŒçš„å‚æ•°ã€‚é™¤äº†èƒ½é‡å®šå‘æ½œåœ¨åŒ¹é…ã€é˜»æ­¢åŠ è½½è¯·æ±‚ç­‰åŠŸèƒ½å¤–ï¼Œå®ƒè¿˜å¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šè¢«åˆå¹¶åˆ°è·¯ç”±çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šè¿‡`beforeLoad`é€‰é¡¹å‘è·¯ç”±ä¸Šä¸‹æ–‡æ³¨å…¥æ•°æ®çš„ä¾‹å­ï¼š

```tsx
// /routes/posts.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/posts')({
  // å°†fetchPostså‡½æ•°ä¼ é€’ç»™è·¯ç”±ä¸Šä¸‹æ–‡
  beforeLoad: () => ({
    fetchPosts: () => console.info('foo'),
  }),
  loader: ({ context: { fetchPosts } }) => {
    console.info(fetchPosts()) // 'foo'

    // ...
  },
})
```

## åœ¨åŠ è½½å™¨ä¸­ä½¿ç”¨æœç´¢å‚æ•°

> â“ ä½†æ˜¯ç­‰ç­‰Tanner...æˆ‘çš„æœç´¢å‚æ•°è·‘å“ªå»äº†ï¼Ÿï¼

ä½ å¯èƒ½åœ¨ç–‘æƒ‘ä¸ºä»€ä¹ˆ`search`æ²¡æœ‰ç›´æ¥å‡ºç°åœ¨`loader`å‡½æ•°çš„å‚æ•°ä¸­ã€‚æˆ‘ä»¬è¿™æ ·è®¾è®¡æ˜¯æœ‰æ„ä¸ºä¹‹ï¼Œç›®çš„æ˜¯å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨ã€‚æ¥çœ‹çœ‹åŸå› ï¼š

- åœ¨åŠ è½½å™¨å‡½æ•°ä¸­ä½¿ç”¨æœç´¢å‚æ•°ï¼Œé€šå¸¸æ„å‘³ç€è¿™äº›æœç´¢å‚æ•°ä¹Ÿåº”è¢«ç”¨æ¥å”¯ä¸€æ ‡è¯†æ­£åœ¨åŠ è½½çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªè·¯ç”±ä½¿ç”¨`pageIndex`è¿™æ ·çš„æœç´¢å‚æ•°æ¥å”¯ä¸€æ ‡è¯†è·¯ç”±åŒ¹é…ä¸­çš„æ•°æ®ã€‚æˆ–è€…æƒ³è±¡ä¸€ä¸ª`/users/user`è·¯ç”±ï¼Œå®ƒä½¿ç”¨`userId`æœç´¢å‚æ•°æ¥æ ‡è¯†åº”ç”¨ä¸­çš„ç‰¹å®šç”¨æˆ·ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·è®¾è®¡URLï¼š`/users/user?userId=123`ã€‚è¿™æ„å‘³ç€ä½ çš„`user`è·¯ç”±éœ€è¦é¢å¤–å¸®åŠ©æ¥è¯†åˆ«ç‰¹å®šç”¨æˆ·ã€‚
- ç›´æ¥åœ¨åŠ è½½å™¨å‡½æ•°ä¸­è®¿é—®æœç´¢å‚æ•°å¯èƒ½å¯¼è‡´ç¼“å­˜å’Œé¢„åŠ è½½ä¸­çš„é”™è¯¯ï¼Œå› ä¸ºåŠ è½½çš„æ•°æ®ä¸ä¸å½“å‰URLè·¯å¾„å’Œæœç´¢å‚æ•°å”¯ä¸€å¯¹åº”ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½è¦æ±‚`/posts`è·¯ç”±é¢„åŠ è½½ç¬¬2é¡µçš„ç»“æœï¼Œä½†å¦‚æœè·¯ç”±é…ç½®ä¸­æ²¡æœ‰åŒºåˆ†é¡µé¢ï¼Œä½ æœ€ç»ˆä¼šåœ¨`/posts`æˆ–`?page=1`å±å¹•ä¸Šè·å–ã€å­˜å‚¨å’Œæ˜¾ç¤ºç¬¬2é¡µçš„æ•°æ®ï¼Œè€Œä¸æ˜¯åœ¨åå°é¢„åŠ è½½ï¼
- åœ¨æœç´¢å‚æ•°å’ŒåŠ è½½å™¨å‡½æ•°ä¹‹é—´è®¾ç½®ä¸€ä¸ªé—¨æ§›ï¼Œèƒ½è®©è·¯ç”±ç†è§£ä½ çš„ä¾èµ–å’Œå“åº”æ€§ã€‚

```tsx
// /routes/users.user.tsx
export const Route = createFileRoute('/users/user')({
  validateSearch: (search) =>
    search as {
      userId: string
    },
  loaderDeps: ({ search: { userId } }) => ({
    userId,
  }),
  loader: async ({ deps: { userId } }) => getUser(userId),
})
```

### é€šè¿‡`routeOptions.loaderDeps`è®¿é—®æœç´¢å‚æ•°

```tsx
// /routes/posts.tsx
export const Route = createFileRoute('/posts')({
  // ä½¿ç”¨zodéªŒè¯å’Œè§£ææœç´¢å‚æ•°
  validateSearch: z.object({
    offset: z.number().int().nonnegative().catch(0),
  }),
  // é€šè¿‡loaderDepså‡½æ•°å°†offsetä¼ é€’ç»™åŠ è½½å™¨ä¾èµ–
  loaderDeps: ({ search: { offset } }) => ({ offset }),
  // åœ¨åŠ è½½å™¨å‡½æ•°ä¸­ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„offset
  loader: async ({ deps: { offset } }) =>
    fetchPosts({
      offset,
    }),
})
```

## ä½¿ç”¨ä¸­æ­¢ä¿¡å·

`loader`å‡½æ•°çš„`abortController`å±æ€§æ˜¯ä¸€ä¸ª[AbortController](https://developer.mozilla.org/en-US/docs/Web/API/AbortController)ã€‚å½“è·¯ç”±å¸è½½æˆ–`loader`è°ƒç”¨è¿‡æ—¶æ—¶ï¼Œå…¶ä¿¡å·ä¼šè¢«å–æ¶ˆã€‚è¿™åœ¨è·¯ç”±å¸è½½æˆ–è·¯ç”±å‚æ•°å˜åŒ–æ—¶å–æ¶ˆç½‘ç»œè¯·æ±‚éå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¸fetchè°ƒç”¨ä¸€èµ·ä½¿ç”¨çš„ç¤ºä¾‹ï¼š

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: ({ abortController }) =>
    fetchPosts({
      // å°†æ­¤ä¼ é€’ç»™åº•å±‚fetchè°ƒç”¨æˆ–ä»»ä½•æ”¯æŒsignalçš„å¯¹è±¡
      signal: abortController.signal,
    }),
})
```

## ä½¿ç”¨`preload`æ ‡å¿—

`loader`å‡½æ•°çš„`preload`å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå½“è·¯ç”±è¢«é¢„åŠ è½½è€ŒéåŠ è½½æ—¶ä¸º`true`ã€‚ä¸€äº›æ•°æ®åŠ è½½åº“å¯èƒ½ä»¥ä¸åŒäºæ ‡å‡†fetchçš„æ–¹å¼å¤„ç†é¢„åŠ è½½ï¼Œå› æ­¤ä½ å¯èƒ½æƒ³å°†`preload`ä¼ é€’ç»™æ•°æ®åŠ è½½åº“ï¼Œæˆ–ä½¿ç”¨å®ƒæ¥æ‰§è¡Œé€‚å½“çš„æ•°æ®åŠ è½½é€»è¾‘ï¼š

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: async ({ preload }) =>
    fetchPosts({
      maxAge: preload ? 10_000 : 0, // é¢„åŠ è½½çš„æ•°æ®åº”ä¿ç•™æ›´ä¹…
    }),
})
```

## å¤„ç†æ…¢åŠ è½½å™¨

ç†æƒ³æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°è·¯ç”±åŠ è½½å™¨éƒ½èƒ½åœ¨çŸ­æ—¶é—´å†…è§£æå…¶æ•°æ®ï¼Œæ— éœ€æ¸²æŸ“å ä½ç¬¦spinnerï¼Œåªéœ€ä¾èµ–suspenseåœ¨è·¯ç”±å®Œå…¨å‡†å¤‡å¥½æ—¶æ¸²æŸ“ä¸‹ä¸€ä¸ªè·¯ç”±ã€‚ä½†å½“æ¸²æŸ“è·¯ç”±ç»„ä»¶æ‰€éœ€çš„å…³é”®æ•°æ®è¾ƒæ…¢æ—¶ï¼Œä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

- å°†å¿«é€Ÿå’Œæ…¢é€Ÿæ•°æ®æ‹†åˆ†ä¸ºå•ç‹¬çš„promiseï¼Œå¹¶åœ¨å¿«é€Ÿæ•°æ®åŠ è½½å`defer`æ…¢é€Ÿæ•°æ®ï¼ˆå‚è§[å»¶è¿Ÿæ•°æ®åŠ è½½](./deferred-data-loading.md)æŒ‡å—ï¼‰ã€‚
- åœ¨ä¹è§‚suspenseé˜ˆå€¼åæ˜¾ç¤ºä¸€ä¸ªå¾…å¤„ç†ç»„ä»¶ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®å‡†å¤‡å°±ç»ªï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

## æ˜¾ç¤ºå¾…å¤„ç†ç»„ä»¶

**é»˜è®¤æƒ…å†µä¸‹ï¼ŒTanStack Routerä¼šåœ¨åŠ è½½å™¨è§£ææ—¶é—´è¶…è¿‡1ç§’æ—¶æ˜¾ç¤ºå¾…å¤„ç†ç»„ä»¶ã€‚** è¿™æ˜¯ä¸€ä¸ªä¹è§‚é˜ˆå€¼ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®ï¼š

- `routeOptions.pendingMs` æˆ–
- `routerOptions.defaultPendingMs`

å½“è¶…è¿‡å¾…å¤„ç†æ—¶é—´é˜ˆå€¼æ—¶ï¼Œå¦‚æœé…ç½®äº†`pendingComponent`é€‰é¡¹ï¼Œè·¯ç”±å°†æ¸²æŸ“è¯¥ç»„ä»¶ã€‚

## é¿å…å¾…å¤„ç†ç»„ä»¶é—ªçƒ

å¦‚æœä½¿ç”¨å¾…å¤„ç†ç»„ä»¶ï¼Œæœ€ä¸å¸Œæœ›çœ‹åˆ°çš„æ˜¯å¾…å¤„ç†æ—¶é—´é˜ˆå€¼åˆšæ»¡è¶³ï¼Œæ•°æ®å°±ç«‹å³è§£æï¼Œå¯¼è‡´å¾…å¤„ç†ç»„ä»¶å‡ºç°åˆºçœ¼çš„é—ªçƒã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œ**TanStack Routeré»˜è®¤ä¼šæ˜¾ç¤ºå¾…å¤„ç†ç»„ä»¶è‡³å°‘500ms**ã€‚è¿™æ˜¯ä¸€ä¸ªä¹è§‚é˜ˆå€¼ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®ï¼š

- `routeOptions.pendingMinMs` æˆ–
- `routerOptions.defaultPendingMinMs`

## å¤„ç†é”™è¯¯

TanStack Routeræä¾›äº†å‡ ç§å¤„ç†è·¯ç”±åŠ è½½ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿçš„é”™è¯¯çš„æ–¹å¼ã€‚æ¥çœ‹çœ‹å®ƒä»¬ã€‚

### ä½¿ç”¨`routeOptions.onError`å¤„ç†é”™è¯¯

`routeOptions.onError`é€‰é¡¹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“è·¯ç”±åŠ è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  onError: ({ error }) => {
    // è®°å½•é”™è¯¯
    console.error(error)
  },
})
```

### ä½¿ç”¨`routeOptions.onCatch`å¤„ç†é”™è¯¯

`routeOptions.onCatch`é€‰é¡¹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“è·¯ç”±çš„CatchBoundaryæ•è·åˆ°é”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  onCatch: ({ error, errorInfo }) => {
    // è®°å½•é”™è¯¯
    console.error(error)
  },
})
```

### ä½¿ç”¨`routeOptions.errorComponent`å¤„ç†é”™è¯¯

`routeOptions.errorComponent`é€‰é¡¹æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå½“è·¯ç”±åŠ è½½æˆ–æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿé”™è¯¯æ—¶æ¸²æŸ“ã€‚å®ƒæ¥æ”¶ä»¥ä¸‹propsï¼š

- `error` - å‘ç”Ÿçš„é”™è¯¯
- `reset` - é‡ç½®å†…éƒ¨`CatchBoundary`çš„å‡½æ•°

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  errorComponent: ({ error }) => {
    // æ¸²æŸ“é”™è¯¯ä¿¡æ¯
    return <div>{error.message}</div>
  },
})
```

`reset`å‡½æ•°å¯ç”¨äºå…è®¸ç”¨æˆ·é‡è¯•æ¸²æŸ“é”™è¯¯è¾¹ç•Œçš„æ­£å¸¸å­å…ƒç´ ï¼š

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  errorComponent: ({ error, reset }) => {
    return (
      <div>
        {error.message}
        <button
          onClick={() => {
            // é‡ç½®è·¯ç”±é”™è¯¯è¾¹ç•Œ
            reset()
          }}
        >
          é‡è¯•
        </button>
      </div>
    )
  },
})
```

å¦‚æœé”™è¯¯æ˜¯è·¯ç”±åŠ è½½çš„ç»“æœï¼Œä½ åº”è¯¥è°ƒç”¨`router.invalidate()`ï¼Œè¿™å°†åè°ƒè·¯ç”±é‡æ–°åŠ è½½å’Œé”™è¯¯è¾¹ç•Œé‡ç½®ï¼š

```tsx
// routes/posts.tsx
export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  errorComponent: ({ error, reset }) => {
    const router = useRouter()

    return (
      <div>
        {error.message}
        <button
          onClick={() => {
            // ä½¿è·¯ç”±æ— æ•ˆä»¥é‡æ–°åŠ è½½åŠ è½½å™¨ï¼ŒåŒæ—¶é‡ç½®é”™è¯¯è¾¹ç•Œ
            router.invalidate()
          }}
        >
          é‡è¯•
        </button>
      </div>
    )
  },
})
```

### ä½¿ç”¨é»˜è®¤`ErrorComponent`

TanStack Routeræä¾›äº†ä¸€ä¸ªé»˜è®¤çš„`ErrorComponent`ï¼Œå½“è·¯ç”±åŠ è½½æˆ–æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿé”™è¯¯æ—¶æ¸²æŸ“ã€‚å¦‚æœä½ é€‰æ‹©è¦†ç›–è·¯ç”±çš„é”™è¯¯ç»„ä»¶ï¼Œæ˜æ™ºçš„åšæ³•æ˜¯å§‹ç»ˆå›é€€åˆ°ä½¿ç”¨é»˜è®¤`ErrorComponent`æ¸²æŸ“ä»»ä½•æœªæ•è·çš„é”™è¯¯ï¼š

```tsx
// routes/posts.tsx
import { createFileRoute, ErrorComponent } from '@tanstack/react-router'

export const Route = createFileRoute('/posts')({
  loader: () => fetchPosts(),
  errorComponent: ({ error }) => {
    if (error instanceof MyCustomError) {
      // æ¸²æŸ“è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯
      return <div>{error.message}</div>
    }

    // å›é€€åˆ°é»˜è®¤ErrorComponent
    return <ErrorComponent error={error} />
  },
})
```
